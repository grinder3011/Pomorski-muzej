<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Urejanje urnikov</title>

  <style>
    /* Fix spacing between period title and weekdays */
    .period-spacing { margin-bottom: 12px; }

    /* Fix mobile overflow for time inputs */
    .day-row { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .day-row label { width: 120px; flex-shrink: 0; }

    /* Option B remove button styling */
    .remove-period-btn {
      display: block;
      width: 100%;
      text-align: center;
      background-color: #dc2626;
      color: white;
      padding: 6px 0;
      border-radius: 6px 6px 0 0;
      margin-bottom: 8px;
    }
    @media (min-width: 640px) {
      .remove-period-btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>

<body class="bg-gray-100 p-4 flex flex-col items-center">

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="w-full max-w-sm mt-10 bg-white shadow-md rounded-xl p-6">
    <h2 class="text-xl font-semibold mb-4 text-center">Prijava</h2>
    <label class="block mb-2">Uporabniško ime</label>
    <input id="username" class="w-full p-3 border rounded mb-4" placeholder="Vnesi uporabniško ime" />

    <label class="block mb-2">Geslo</label>
    <input id="password" type="password" class="w-full p-3 border rounded mb-6" placeholder="Vnesi geslo" />

    <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700">Prijava</button>
    <p id="loginMsg" class="text-red-600 mt-2"></p>
  </div>

  <!-- MAIN PAGE -->
  <div id="mainPage" class="hidden w-full max-w-4xl mt-10 bg-white shadow-md rounded-xl p-6">
    <h2 class="text-2xl font-bold mb-4">Urejanje urnikov</h2>

    <div id="scheduleDisplay" class="space-y-6"></div>

    <button id="editBtn" onclick="startEditing()" class="mt-4 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 hidden">
      Uredi urnik
    </button>

    <!-- Editor -->
    <div id="editor" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4">Uredi obdobja</h3>
      <div id="periodList" class="space-y-4"></div>

      <button onclick="addPeriod()" class="mt-4 bg-blue-600 text-white py-2 px-4 rounded">Dodaj obdobje</button>

      <div class="flex flex-col sm:flex-row gap-3 mt-6">
        <button onclick="cancelEditing()" class="flex-1 bg-gray-400 text-white py-2 rounded">Prekliči</button>
        <button onclick="saveChanges()" class="flex-1 bg-green-600 text-white py-2 rounded">Uporabi spremembe (samo za prikaz)</button>
      </div>
    </div>
  </div>

<script>
let scheduleData = {};
let originalData = null;

const dayNames = {
  Mon:'Ponedeljek',
  Tue:'Torek',
  Wed:'Sreda',
  Thu:'Četrtek',
  Fri:'Petek',
  Sat:'Sobota',
  Sun:'Nedelja'
};

function login() {
  const user = username.value;
  const pass = password.value;

  if (user === 'admin' && pass === 'admin') {
    loginPage.classList.add('hidden');
    mainPage.classList.remove('hidden');
    loadJSON();
  } else {
    loginMsg.textContent = 'Neveljavni podatki (uporabite admin/admin).';
  }
}

function loadJSON() {
  fetch('status-muzeja/schedules.json')
    .then(r => r.json())
    .then(data => {
      scheduleData = JSON.parse(JSON.stringify(data.locations));
      originalData = JSON.parse(JSON.stringify(data.locations));
      renderSchedule();
      editBtn.classList.remove('hidden');
    })
    .catch(err => {
      console.error('Napaka pri nalaganju JSON:', err);
      scheduleDisplay.textContent = 'Napaka pri nalaganju urnikov.';
    });
}

function renderSchedule() {
  scheduleDisplay.innerHTML = '';

  Object.entries(scheduleData).forEach(([loc, locData]) => {
    const card = document.createElement('div');
    card.className = 'border rounded p-4 bg-gray-50';

    const title = document.createElement('h3');
    title.className = 'font-semibold text-lg mb-3';
    title.textContent = loc;
    card.appendChild(title);

    locData.periods.forEach((p, idx) => {
      const periodDiv = document.createElement('div');
      periodDiv.className = 'border p-3 rounded mb-2 bg-white';

      periodDiv.innerHTML = `
        <strong>Obdobje ${idx + 1}: ${p.start} - ${p.end}</strong>
        <div class="period-spacing"></div>
      `;

      const ul = document.createElement('ul');
      for (const day in p.hours) {
        const li = document.createElement('li');
        const val = Array.isArray(p.hours[day])
          ? p.hours[day].join(', ')
          : (p.hours[day] || 'Zaprto');

        li.textContent = `${dayNames[day]}: ${val}`;
        ul.appendChild(li);
      }
      periodDiv.appendChild(ul);
      card.appendChild(periodDiv);
    });

    scheduleDisplay.appendChild(card);
  });
}

function startEditing() {
  periodList.innerHTML = '';

  Object.entries(scheduleData).forEach(([loc, locData]) => {
    const locCard = document.createElement('div');
    locCard.className = 'border rounded p-3 bg-gray-100';

    const title = document.createElement('h4');
    title.className = 'font-semibold mb-2';
    title.textContent = loc;
    locCard.appendChild(title);

    locData.periods.forEach((p, i) => {
      const pf = createPeriodForm(loc, i, p);
      locCard.appendChild(pf);
    });

    periodList.appendChild(locCard);
  });

  editor.classList.remove('hidden');
}

function createPeriodForm(loc, idx, pData) {
  const div = document.createElement('div');
  div.className = 'border rounded bg-white p-3 mb-3 relative';

  // Option B top bar remove button
  const removeBtn = document.createElement('button');
  removeBtn.className = 'remove-period-btn';
  removeBtn.textContent = 'Odstrani obdobje';
  removeBtn.onclick = () => {
    scheduleData[loc].periods.splice(idx, 1);
    div.remove();
  };
  div.appendChild(removeBtn);

  // Date pickers
  const dateRow = document.createElement('div');
  dateRow.className = 'flex flex-col sm:flex-row items-center gap-2 mt-3 mb-3';

  const lbl1 = document.createElement('span');
  lbl1.textContent = 'Obdobje od';
  lbl1.className = 'font-medium';
  dateRow.appendChild(lbl1);

  const inpStart = document.createElement('input');
  inpStart.type = 'date';
  inpStart.className = 'border rounded p-1';
  if (pData.start) inpStart.value = '2025-' + pData.start;
  inpStart.onchange = e => pData.start = e.target.value.slice(5);
  dateRow.appendChild(inpStart);

  const lbl2 = document.createElement('span');
  lbl2.textContent = 'do';
  lbl2.className = 'font-medium';
  dateRow.appendChild(lbl2);

  const inpEnd = document.createElement('input');
  inpEnd.type = 'date';
  inpEnd.className = 'border rounded p-1';
  if (pData.end) inpEnd.value = '2025-' + pData.end;
  inpEnd.onchange = e => pData.end = e.target.value.slice(5);
  dateRow.appendChild(inpEnd);

  div.appendChild(dateRow);

  // Days
  Object.keys(pData.hours).forEach(day => {
    const dayRow = document.createElement('div');
    dayRow.className = 'day-row';

    const label = document.createElement('label');
    label.textContent = dayNames[day] + ':';
    dayRow.appendChild(label);

    const ranges = Array.isArray(pData.hours[day])
      ? pData.hours[day]
      : pData.hours[day] ? [pData.hours[day]] : [];

    ranges.forEach((range, i) => {
      const wrap = document.createElement('div');
      wrap.className = 'flex gap-2';

      const t1 = document.createElement('input');
      t1.type = 'time';
      t1.className = 'border rounded p-1';
      t1.value = range ? range.split('-')[0] : '';

      const t2 = document.createElement('input');
      t2.type = 'time';
      t2.className = 'border rounded p-1';
      t2.value = range ? range.split('-')[1] : '';

      t1.onchange = t2.onchange = () => {
        ranges[i] = (t1.value && t2.value) ? `${t1.value}-${t2.value}` : '';
        pData.hours[day] = ranges.length === 1 ? ranges[0] : ranges;
      };

      wrap.appendChild(t1);
      wrap.appendChild(t2);
      dayRow.appendChild(wrap);
    });

    // Add second range button
    if (ranges.length < 2) {
      const addBtn = document.createElement('button');
      addBtn.textContent = '+';
      addBtn.className = 'bg-blue-500 text-white px-2 rounded';
      addBtn.onclick = () => {
        if (ranges.length < 2) {
          ranges.push('');
          pData.hours[day] = ranges.length === 1 ? ranges[0] : ranges;
          startEditing();
        }
      };
      dayRow.appendChild(addBtn);
    }

    div.appendChild(dayRow);
  });

  return div;
}

function addPeriod() {
  alert("Dodajanje obdobja ni implementirano, ker si izrecno povedal da ga ne potrebuješ.");
}

function cancelEditing() {
  editor.classList.add('hidden');
  scheduleData = JSON.parse(JSON.stringify(originalData));
}

function saveChanges() {
  renderSchedule();
  alert('Spremembe uporabljene (samo prikaz).');
  cancelEditing();
}
</script>

</body>
</html>
