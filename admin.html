<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Urejanje urnikov</title>
</head>
<body class="bg-gray-100 p-4 flex flex-col items-center">

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="w-full max-w-sm mt-10 bg-white shadow-md rounded-xl p-6">
    <h2 class="text-xl font-semibold mb-4 text-center">Prijava</h2>
    <label class="block mb-2">Uporabniško ime</label>
    <input id="username" class="w-full p-2 border rounded mb-4" placeholder="Vnesi uporabniško ime" />

    <label class="block mb-2">Geslo</label>
    <input id="password" type="password" class="w-full p-2 border rounded mb-6" placeholder="Vnesi geslo" />

    <button onclick="login()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Prijava</button>
    <p id="loginMsg" class="text-red-600 mt-2"></p>
  </div>

  <!-- MAIN PAGE -->
  <div id="mainPage" class="hidden w-full max-w-4xl mt-10 bg-white shadow-md rounded-xl p-6">
    <h2 class="text-2xl font-bold mb-4">Urejanje urnikov</h2>

    <div id="scheduleDisplay" class="space-y-4"></div>

    <button id="editBtn" onclick="startEditing()" class="mt-4 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 hidden">Uredi urnik</button>

    <!-- Editor -->
    <div id="editor" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4">Uredi obdobja</h3>
      <div id="periodList" class="space-y-4"></div>
      <button onclick="addPeriod()" class="mt-4 bg-blue-600 text-white py-2 px-4 rounded">Dodaj obdobje</button>

      <div class="flex gap-3 mt-6">
        <button onclick="cancelEditing()" class="flex-1 bg-gray-400 text-white py-2 rounded">Prekliči</button>
        <button onclick="saveChanges()" class="flex-1 bg-green-600 text-white py-2 rounded">Uporabi spremembe (samo za prikaz)</button>
      </div>
    </div>
  </div>

<script>
let scheduleData = {};
let originalData = null;

function login() {
  const user = document.getElementById('username').value;
  const pass = document.getElementById('password').value;
  const msg = document.getElementById('loginMsg');

  if (user === 'admin' && pass === 'admin') {
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('mainPage').classList.remove('hidden');
    loadJSON();
  } else {
    msg.textContent = 'Neveljavni podatki (uporabite admin/admin).';
  }
}

function loadJSON() {
  fetch('status-muzeja/schedules.json')
    .then(r => r.json())
    .then(data => {
      scheduleData = JSON.parse(JSON.stringify(data.locations));
      originalData = JSON.parse(JSON.stringify(scheduleData));
      renderSchedule();
      document.getElementById('editBtn').classList.remove('hidden');
    })
    .catch(err => {
      console.error('Napaka pri nalaganju JSON:', err);
      document.getElementById('scheduleDisplay').textContent = 'Napaka pri nalaganju urnikov.';
    });
}

function renderSchedule() {
  const container = document.getElementById('scheduleDisplay');
  container.innerHTML = '';

  Object.entries(scheduleData).forEach(([loc, locData]) => {
    const card = document.createElement('div');
    card.className = 'border rounded p-4 bg-gray-50';

    const title = document.createElement('h3');
    title.className = 'font-semibold text-lg mb-2';
    title.textContent = loc;
    card.appendChild(title);

    locData.periods.forEach((p, idx) => {
      const periodDiv = document.createElement('div');
      periodDiv.className = 'border p-2 rounded mb-2 bg-white';
      periodDiv.innerHTML = `<strong>Obdobje ${idx+1}:</strong> ${p.start} - ${p.end}`;

      const ul = document.createElement('ul');
      for (const day in p.hours) {
        const li = document.createElement('li');
        li.textContent = `${day}: ${Array.isArray(p.hours[day]) ? p.hours[day].join(', ') : (p.hours[day] || 'Zaprto')}`;
        ul.appendChild(li);
      }
      periodDiv.appendChild(ul);
      card.appendChild(periodDiv);
    });

    container.appendChild(card);
  });
}

function startEditing() {
  const editor = document.getElementById('editor');
  const list = document.getElementById('periodList');
  list.innerHTML = '';

  Object.entries(scheduleData).forEach(([loc, locData]) => {
    const locCard = document.createElement('div');
    locCard.className = 'border rounded p-3 bg-gray-100';

    const title = document.createElement('h4');
    title.className = 'font-semibold mb-2';
    title.textContent = loc;
    locCard.appendChild(title);

    locData.periods.forEach((p, idx) => {
      const periodDiv = createPeriodForm(loc, idx, p);
      locCard.appendChild(periodDiv);
    });

    const addBtn = document.createElement('button');
    addBtn.textContent = 'Dodaj obdobje';
    addBtn.className = 'mt-2 bg-blue-500 text-white px-3 py-1 rounded';
    addBtn.onclick = () => {
      const newPeriod = {start:'', end:'', hours:{Mon:null,Tue:null,Wed:null,Thu:null,Fri:null,Sat:null,Sun:null}};
      scheduleData[loc].periods.push(newPeriod);
      locCard.insertBefore(createPeriodForm(loc, scheduleData[loc].periods.length-1, newPeriod), addBtn);
    };
    locCard.appendChild(addBtn);

    list.appendChild(locCard);
  });

  editor.classList.remove('hidden');
}

function createPeriodForm(loc, idx, periodData) {
  const div = document.createElement('div');
  div.className = 'border p-2 rounded mb-2 bg-white';

  const startInput = document.createElement('input');
  startInput.type='text'; startInput.value = periodData.start; startInput.placeholder='Začetek (MM-DD)'; startInput.className='border p-1 rounded mr-2';
  startInput.onchange = e => periodData.start = e.target.value;
  div.appendChild(startInput);

  const endInput = document.createElement('input');
  endInput.type='text'; endInput.value = periodData.end; endInput.placeholder='Konec (MM-DD)'; endInput.className='border p-1 rounded';
  endInput.onchange = e => periodData.end = e.target.value;
  div.appendChild(endInput);

  const removeBtn = document.createElement('button');
  removeBtn.textContent = 'Odstrani';
  removeBtn.className = 'ml-2 bg-red-500 text-white px-2 py-1 rounded';
  removeBtn.onclick = () => { scheduleData[loc].periods.splice(idx,1); div.remove(); };
  div.appendChild(removeBtn);

  // Days
  Object.keys(periodData.hours).forEach(day => {
    const dayDiv = document.createElement('div');
    dayDiv.className='flex gap-2 items-center mt-1';
    const label = document.createElement('span'); label.textContent=day+':'; label.className='w-12';
    const input = document.createElement('input');
    input.type='text'; input.value = Array.isArray(periodData.hours[day]) ? periodData.hours[day].join(', ') : (periodData.hours[day] || '');
    input.placeholder='09:00-17:00 ali 09:00-12:00,17:00-21:00';
    input.className='border p-1 rounded flex-1';
    input.onchange = e => {
      const val = e.target.value.trim();
      periodData.hours[day] = val ? (val.includes(',') ? val.split(',') : val) : null;
    };
    dayDiv.appendChild(label);
    dayDiv.appendChild(input);
    div.appendChild(dayDiv);
  });

  return div;
}

function cancelEditing() {
  document.getElementById('editor').classList.add('hidden');
}

function saveChanges() {
  renderSchedule();
  alert('Spremembe uporabljene (samo za prikaz, še niso shranjene).');
  cancelEditing();
}
</script>
</body>
</html>
